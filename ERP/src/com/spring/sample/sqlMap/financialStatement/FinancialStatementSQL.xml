<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE sqlMap PUBLIC "-//iBATIS.com//DTD SQL Map 2.0//EN"
    "http://www.ibatis.com/dtd/sql-map-2.dtd">

<sqlMap namespace="financialStatement">
	<select id="getSub" parameterClass="java.util.HashMap" resultClass="java.util.HashMap" >
		SELECT NO, SUB_NO, DEPTH, NAME
		FROM SUB
		ORDER BY DEPTH
	</select>
	<!-- Select sum(Money) money1,Listagg(name||','||money,',') within group(order by money) money from (select sum(money) money, B.name from sal_chit A inner join sub B on A.Creditor_no=B.no group by B.name) -->
	<select id="getIncomeData" resultClass="java.util.HashMap" parameterClass="java.util.HashMap">
	Select sum(Money) money,Listagg(name||','||money,',') Within Group(Order by money) subMoney from(
    SELECT sum(MONEY) money,B.Name
    From sal_chit A Inner Join Sub B
    on A.Creditor_No=B.no
    where 1=1
   and To_char(DEAL_DATE,'YYYYMM') BETWEEN '201701' AND '201712'
   Group By B.Name)
   union all
   Select sum(Money) money,Listagg(name||','||money,',') Within Group(Order by money) subMoney from(
    SELECT sum(MONEY) money,B.Name
    From inc_chit A Inner Join Sub B
    on A.Debtor_No=B.no
    where 1=1
   and To_char(DEAL_DATE,'YYYYMM') BETWEEN '201701' AND '201712'
   Group By B.Name)
   union all
   Select sum(Money) money,Listagg(name||','||money,',') Within Group(Order by money) subMoney from(
    SELECT sum(MONEY) money,B.Name
    From Oth_Inc_Chit A Inner Join Sub B
    on A.Debtor_No=B.no
    where 1=1
   and To_char(DEAL_DATE,'YYYYMM') BETWEEN '201701' AND '201712'
   Group By B.Name)
   union all
   Select sum(Money) money,Listagg(name||','||money,',') Within Group(Order by money) subMoney from(
    SELECT sum(MONEY) money,B.Name
    From Oth_sal_Chit A Inner Join Sub B
    on A.Creditor_No=B.no
    where 1=1
   and To_char(DEAL_DATE,'YYYYMM') BETWEEN '201701' AND '201712'
   Group By B.Name)
    
	
	</select>

</sqlMap>